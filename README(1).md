# Variational Autoencoder(VAE) for image reconstruction by the animation faces dataset
In this VAE example, I use five ConvNets for the encoder and decoder networks.

## Encoder
This defines the approximate posterior distribution ![](http://latex.codecogs.com/svg.latex?q(z|x)), which takes as input an observation and outputs a set of parameters for specifying the conditional distribution of the latent representation ![](http://latex.codecogs.com/svg.latex?z). In this example, simply model the distribution as a diagonal Gaussian, and the network outputs the mean and log-variance parameters of a factorized Gaussian. Output log-variance instead of the variance directly for numerical stability.
## Decoder
This defines the conditional distribution of the observation ![](http://latex.codecogs.com/svg.latex?q(x|z)), which takes a latent sample  as input and outputs the parameters for a conditional distribution of the observation. Model the latent distribution prior ![](http://latex.codecogs.com/svg.latex?p(z)) as a unit Gaussian.
## Reparameterization trick
To generate a sample ![](http://latex.codecogs.com/svg.latex?z) for the decoder during training, you can sample from the latent distribution defined by the parameters outputted by the encoder, given an input observation ![](http://latex.codecogs.com/svg.latex?x). However, this sampling operation creates a bottleneck because backpropagation cannot flow through a random node.

To address this, use a reparameterization trick. In our example, you approximate ![](http://latex.codecogs.com/svg.latex?z) using the decoder parameters and another parameter ![](http://latex.codecogs.com/svg.latex?\epsilon) as follows:

![](http://latex.codecogs.com/svg.latex?z = \mu + \sigma \odot \epsilon)
where ![](http://latex.codecogs.com/svg.latex?\mu) and ![](http://latex.codecogs.com/svg.latex?\sigma) represent the mean and standard deviation of a Gaussian distribution respectively. They can be derived from the decoder output. The ![](http://latex.codecogs.com/svg.latex?\epsilon) can be thought of as a random noise used to maintain stochasticity of ![](http://latex.codecogs.com/svg.latex?z). Generate ![](http://latex.codecogs.com/svg.latex?\epsilon) from a standard normal distribution.

The latent variable ![](http://latex.codecogs.com/svg.latex?z) is now generated by a function of ![](http://latex.codecogs.com/svg.latex?\mu), ![](http://latex.codecogs.com/svg.latex?\sigma) and ![](http://latex.codecogs.com/svg.latex?\epsilon), which would enable the model to backpropagate gradients in the encoder through ![](http://latex.codecogs.com/svg.latex?\mu) and ![](http://latex.codecogs.com/svg.latex?\sigma) respectively, while maintaining stochasticity through ![](http://latex.codecogs.com/svg.latex?\epsilon).
